$(function(){"use strict";var $kapmap,currentDep,dateMax,dateMin,clusters={};$("#map-detail").kapmap({polyStyle:{fillColor:"red",fillOpacity:.5,strokeWeight:1,strokeColor:"#444",clickable:false,editable:false,zIndex:1}});$kapmap=$("#map-detail").data("kapmap");enableClusterers();getManifestations(null,0).done(function(d){injectManifestations(d,true)});function getSelectedCategories(){var selected=new Array;$("#categories input[data-cat]:checked").each(function(){selected.push($(this).attr("data-cat"))});return selected}function injectManifestations(result,reset){if(reset){$kapmap.clearMarkers();clearClusterers()}var me=result.manif;$kapmap.setMapCenter(new google.maps.LatLng(me.gps[0],me.gps[1]),13);var data=result.near;for(var i=0;i<data.length;i++){if(!data[i].gps)continue;var marker,icon;switch(data[i].type){case"auto":icon="/media/ui/img/map/marker-red.png";break;case"moto":icon="/media/ui/img/map/marker-blue.png";break;case"collection":icon="/media/ui/img/map/marker-yellow.png";break;default:icon="/media/ui/img/map/marker-red.png"}marker=$kapmap.displayCustomMarker(data[i].gps,icon,$kapmap.getInfoWindow('<p class="infotitle">'+data[i].name+"</p>"+'<a href="'+data[i].link+'">En savoir +</a>'));marker._kapdata=data[i];marker.on("click",function(){$kapmap.closeInfoWindows();this._kapinfo.open($kapmap.map,this)});var checkok=true;var poly=$kapmap.getLastPolygon();if(poly&&poly.constructor===google.maps.Polygon){var bounds=poly.getBounds();if(!bounds.contains(marker.getPosition())){marker.setMap(null);checkok=false;console.warn("-- BOUNDS CHECK FAILED FOR ",marker._kapdata._id);$.ajax({url:"/map/fail",data:{_id:marker._kapdata._id}})}}}marker=$kapmap.displayCustomMarker(result.manif.gps,"/media/ui/img/map/marker-grey.png",$kapmap.getInfoWindow('<p class="infotitle">'+me.name+"</p>"+'<a href="/manifestation/'+me._id+'">En savoir +</a>'));marker._kapdata=me}function getManifestations(type,dep){var data={near:$("#map-detail").attr("data-id")};return $.ajax({url:"/map/manifestation",dataType:"json",data:data})}function clearClusterers(){clusters.moto.clearMarkers();clusters.auto.clearMarkers();clusters.collection.clearMarkers()}function enableClusterers(){clusters.moto={gridSize:50,styles:[{textColor:"white",url:"/media/ui/img/map/cluster-blue.png",height:33,width:33},{textColor:"white",url:"/media/ui/img/map/cluster-blue.png",height:33,width:33},{textColor:"white",url:"/media/ui/img/map/cluster-blue.png",height:33,width:33}]};clusters.auto={gridSize:50,styles:[{textColor:"white",url:"/media/ui/img/map/cluster-red.png",height:33,width:33},{textColor:"white",url:"/media/ui/img/map/cluster-red.png",height:33,width:33},{textColor:"white",url:"/media/ui/img/map/cluster-red.png",height:33,width:33}]};clusters.collection={gridSize:50,styles:[{textColor:"white",url:"/media/ui/img/map/cluster-yellow.png",height:33,width:33},{textColor:"white",url:"/media/ui/img/map/cluster-yellow.png",height:33,width:33},{textColor:"white",url:"/media/ui/img/map/cluster-yellow.png",height:33,width:33}]};clusters.moto=new MarkerClusterer($kapmap.map,[],clusters.moto);clusters.auto=new MarkerClusterer($kapmap.map,[],clusters.auto);clusters.collection=new MarkerClusterer($kapmap.map,[],clusters.collection)}});
//# sourceMappingURL=manifestation-detail-sos.js.map